## **Analyse der Module f√ºr EN 13813 Normkonformit√§t**

### **Was ist bereits gut abgedeckt ‚úÖ**

Die Dokumentation zeigt solides Verst√§ndnis der Anforderungen:
- ITT-Konzept verstanden (Initial Type Testing)
- FPC-Anforderungen erkannt (Factory Production Control)
- Verkn√ºpfung Rezeptur ‚Üî ITT ‚Üî DoP
- Ablaufverfolgung (5 Jahre G√ºltigkeit ITT)
- Grenzwert√ºberwachung

### **Was fehlt noch f√ºr EN 13813 Konformit√§t ‚ùå**

## **1. MODUL: PR√úFBERICHTE (ITT & Typ-Pr√ºfungen)**

### **Fehlende Normspezifische Elemente:**

#### **ITT-Pr√ºfmatrix nach EN 13813**
```typescript
interface ITTRequirements {
  // Pflichtpr√ºfungen je nach Deklaration
  mandatoryTests: {
    'CT/CA/MA': [
      { test: 'Druckfestigkeit', norm: 'EN 13892-2', age: 28 },
      { test: 'Biegezugfestigkeit', norm: 'EN 13892-2', age: 28 }
    ],
    'AS': [
      { test: 'Eindr√ºcktiefe', norm: 'EN 13813', age: 'n/a' }
    ],
    'SR': [
      { test: 'Verbundfestigkeit', norm: 'EN 13892-8', age: 7 }
    ]
  },
  
  // Bedingte Pr√ºfungen
  conditionalTests: {
    wearingSurface: [
      { test: 'Verschlei√ü B√∂hme', norm: 'EN 13892-3' },
      { test: 'Verschlei√ü BCA', norm: 'EN 13892-4' },
      { test: 'Verschlei√ü Rollrad', norm: 'EN 13892-5' }
    ],
    withFlooring: [
      { test: 'RWFC', norm: 'EN 13892-7' }
    ],
    heated: [
      { test: 'W√§rmeleitf√§higkeit', norm: 'EN 12664' }
    ]
  }
}
```

#### **AVCP-System Integration**
```typescript
interface TestReportAVCP {
  // Bei System 3 (Brandklasse ‚â† NPD)
  notifiedBodyTests: {
    testLab: string           // Name der notifizierten Stelle
    nbNumber: string          // z.B. "0672"
    fireTestReport: string    // Pr√ºfbericht-Nr
    classification: string   // z.B. "Bfl-s1"
    validUntil: Date         // System 3 Zertifikate haben Ablaufdatum
  }
  
  // Bei System 4
  manufacturerTests: {
    internalLab: boolean
    externalLab?: string
    noNotifiedBodyRequired: true
  }
}
```

#### **Pr√ºfalter-Spezifikation**
```typescript
interface TestAge {
  standard: 28,  // Tage - Normalfall
  early?: {       // Fr√ºhfestigkeit
    age: number,  // z.B. 7 Tage
    mustDeclareInDesignation: true  // CT-C25-F4 (7d)
  }
}
```

## **2. MODUL: LABORWERTE (FPC/WPK)**

### **Fehlende EN 13813 spezifische Kontrollen:**

#### **Pflicht-Kontrollpunkte nach EN 13813**
```typescript
interface FPCRequirements {
  // Eingangskontrolle Rohstoffe
  incomingMaterials: {
    cement: {
      frequency: 'per_delivery',
      checks: ['certificate', 'visual', 'setting_time'],
      standard: 'EN 197-1'
    },
    aggregates: {
      frequency: 'weekly',
      checks: ['grading', 'moisture', 'density'],
      standard: 'EN 13139'
    }
  },
  
  // Produktionskontrolle
  production: {
    freshMortar: {
      frequency: 'per_batch',
      tests: ['consistency', 'temperature', 'ph'],
      limits: 'as_per_recipe'
    },
    hardenedMortar: {
      frequency: 'monthly_min',
      tests: ['compressive_28d', 'flexural_28d'],
      acceptanceCriteria: {
        individual: '‚â• 0.85 √ó declared',
        mean_of_3: '‚â• 0.95 √ó declared'
      }
    }
  },
  
  // Kontrollfrequenzen nach Produktionsvolumen
  frequencyMatrix: {
    low: { // < 500 m¬≥/Jahr
      freshMortar: 'daily',
      hardenedMortar: 'monthly'
    },
    medium: { // 500-5000 m¬≥/Jahr
      freshMortar: 'per_batch',
      hardenedMortar: 'weekly'
    },
    high: { // > 5000 m¬≥/Jahr
      freshMortar: 'continuous',
      hardenedMortar: '2x_weekly'
    }
  }
}
```

#### **Statistische Prozesslenkung (SPC)**
```typescript
interface SPCRequirements {
  // Kontrollkarten
  controlCharts: {
    xBar_R: true,     // Mittelwert und Spannweite
    cusum: true,      // Kumulierte Summe
    limits: {
      warning: '2œÉ',  // Warngrenze
      action: '3œÉ'    // Eingriffsgrenze
    }
  },
  
  // F√§higkeitsindizes
  processCapability: {
    cpk: number,      // Minimum 1.33
    evaluationPeriod: '3_months'
  }
}
```

## **üìã IMPLEMENTIERUNGSPLAN**

### **Phase 1: ITT-Pr√ºfberichte (4 Tage)**

#### **Tag 1: Datenmodell**
```sql
CREATE TABLE test_reports (
  id UUID PRIMARY KEY,
  recipe_id UUID REFERENCES recipes(id),
  report_type ENUM('ITT', 'FPC', 'System3'),
  test_lab TEXT NOT NULL,
  notified_body_number TEXT, -- Bei System 3
  report_number TEXT NOT NULL,
  test_date DATE NOT NULL,
  valid_until DATE, -- ITT: test_date + 5 Jahre
  
  -- Testergebnisse als JSONB
  test_results JSONB,
  /* Struktur:
  {
    "compressive_strength": {
      "value": 28.5,
      "unit": "N/mm¬≤",
      "class": "C25",
      "age_days": 28,
      "norm": "EN 13892-2",
      "passed": true
    }
  }
  */
  
  pdf_url TEXT,
  status ENUM('valid', 'expired', 'superseded'),
  created_at TIMESTAMP
);
```

#### **Tag 2: Validierungslogik**
```typescript
class ITTValidator {
  validateAgainstRecipe(testReport: TestReport, recipe: Recipe): ValidationResult {
    const errors = []
    
    // Pr√ºfe ob alle deklarierten Eigenschaften getestet wurden
    if (recipe.compressive_strength !== 'NPD') {
      if (!testReport.results.compressive_strength) {
        errors.push('Druckfestigkeit deklariert aber nicht getestet')
      }
      if (testReport.results.compressive_strength.class < recipe.compressive_strength) {
        errors.push('Getestete Druckfestigkeit unter Deklaration')
      }
    }
    
    // Pr√ºfe G√ºltigkeit
    if (testReport.valid_until < new Date()) {
      errors.push('ITT abgelaufen - neue Erstpr√ºfung erforderlich')
    }
    
    return { valid: errors.length === 0, errors }
  }
}
```

#### **Tag 3: UI-Integration**
- Upload-Formular mit OCR-Option f√ºr PDF-Extraktion
- Automatische Verkn√ºpfung zu Rezeptur
- Status-Dashboard mit Ablaufwarnung

#### **Tag 4: DoP-Integration**
```typescript
// DoP kann nur erstellt werden wenn:
if (recipe.hasValidITT() && recipe.status === 'active') {
  enableDoPGeneration()
} else {
  showError('ITT fehlt oder abgelaufen')
}
```

### **Phase 2: FPC-Laborwerte (3 Tage)**

#### **Tag 1: Erfassungssystem**
```typescript
interface LabValueEntry {
  batch_id: string
  sample_datetime: DateTime
  test_type: 'fresh' | 'hardened'
  
  // Frischm√∂rtel
  fresh?: {
    consistency_mm: number,
    temperature_c: number,
    ph: number
  },
  
  // Festm√∂rtel
  hardened?: {
    age_days: number,
    compressive_mpa: number,
    flexural_mpa: number,
    density_kg_m3: number
  },
  
  // Bewertung
  evaluation: {
    within_limits: boolean,
    deviation_percent: number,
    action_required?: string
  }
}
```

#### **Tag 2: Grenzwert-System**
```typescript
class LimitChecker {
  checkValue(actual: number, declared: number, property: string): CheckResult {
    const limits = {
      individual_min: declared * 0.85,
      mean_min: declared * 0.95,
      warning: declared * 0.90
    }
    
    if (actual < limits.individual_min) {
      return { 
        status: 'FAIL', 
        action: 'Charge sperren, Ursachenanalyse'
      }
    }
    
    if (actual < limits.warning) {
      return { 
        status: 'WARNING', 
        action: 'Prozess √ºberpr√ºfen'
      }
    }
    
    return { status: 'PASS' }
  }
}
```

#### **Tag 3: Trend-Analyse**
- Kontrollkarten (XÃÑ-R Charts)
- Cpk-Berechnung
- Automatische Berichte

### **Phase 3: Compliance-Dashboard (1 Tag)**
```typescript
interface ComplianceDashboard {
  recipes: {
    total: number,
    with_valid_itt: number,
    itt_expiring_soon: number
  },
  
  production: {
    batches_today: number,
    tests_required: number,
    tests_completed: number,
    pass_rate: number
  },
  
  alerts: [
    'ITT f√ºr CT-C25-F4 l√§uft in 30 Tagen ab',
    'Charge 2025-01-15-001 unter Grenzwert'
  ]
}
```

## **üéØ Priorisierung**

**Sofort erforderlich f√ºr Normkonformit√§t:**
1. ITT-Verwaltung mit G√ºltigkeitspr√ºfung
2. Verkn√ºpfung ITT ‚Üí Rezeptur ‚Üí DoP
3. Basis-FPC Dokumentation

**Wichtig f√ºr Qualit√§t:**
4. Grenzwert√ºberwachung
5. Trend-Analyse
6. Automatische Warnungen

**Nice-to-have:**
7. OCR f√ºr PDF-Extraktion
8. Erweiterte Statistiken
9. Prognose-Modelle

Mit dieser Implementierung erf√ºllt das System alle EN 13813 Anforderungen f√ºr Pr√ºfberichte und Laborwerte!